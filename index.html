<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>80 Tahun Kemerdekaan RI, AR Selfie Frame</title>
  <style>
    html, body {
      height:100%;
      margin:0;
      background:#000;
      font-family:system-ui, -apple-system, 'Segoe UI', Roboto, 'Noto Sans', 'Helvetica Neue', Arial;
      color:#fff;
    }
    #app {
      position:relative;
      width:100%;
      height:100vh;
      overflow:hidden;
      display:flex;
      justify-content:center;
      align-items:center;
    }
    .portrait-wrapper {
      position:relative;
      width:100%;
      max-width:500px;
      aspect-ratio:3/4;
      background:black;
      overflow:hidden;
    }
    video#camera {
      position:absolute;
      top:50%;
      left:50%;
      height:100%;
      transform:translate(-50%,-50%);
      object-fit:cover;
      background:#111;
    }
    .overlay-wrap { position:absolute; inset:0; pointer-events:none; display:flex; align-items:center; justify-content:center; }
    svg.overlay { width:100%; height:100%; }
    .ui { position:absolute; left:0; right:0; bottom:18px; display:flex; gap:12px; justify-content:center; pointer-events:auto; z-index:30; }
    button { background:#e21b2d; color:white; border:none; padding:12px 16px; border-radius:10px; font-size:16px; box-shadow:0 6px 18px rgba(0,0,0,0.25); }
    button.secondary { background:rgba(255,255,255,0.12); }
    .topbar { position:absolute; left:12px; top:12px; display:flex; gap:8px; pointer-events:auto; z-index:30; }
    .chip { background:rgba(0,0,0,0.45); color:white; padding:8px 10px; border-radius:999px; font-size:14px; }
    .message { position:absolute; right:12px; top:12px; max-width:320px; background:rgba(0,0,0,0.55); padding:12px; border-radius:10px; font-size:13px; z-index:35; }
    input[type=file] { display:none; }
    .sr-only { position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); border:0; }
    .warning { background:#ffcdd2; color:#000; padding:10px; border-radius:8px; font-size:13px; }
  </style>
</head>
<body>
  <div id="app">
    <div class="portrait-wrapper">
      <video id="camera" autoplay playsinline muted></video>
      <div class="overlay-wrap" aria-hidden="true">
        <svg class="overlay" viewBox="0 0 360 780" preserveAspectRatio="xMidYMid slice" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <mask id="center-hole">
              <rect x="0" y="0" width="100%" height="100%" fill="white" />
              <rect x="36" y="140" width="288" height="360" rx="18" ry="18" fill="black" />
            </mask>
          </defs>
          <g mask="url(#center-hole)">
            <rect x="0" y="0" width="100%" height="120" fill="#e21b2d" />
            <text x="50%" y="64" text-anchor="middle" alignment-baseline="middle" font-size="22" font-weight="700" fill="#fff">80 Tahun Kemerdekaan RI</text>
            <text x="50%" y="92" text-anchor="middle" alignment-baseline="middle" font-size="12" fill="#fff">Dirgahayu Republik Indonesia</text>
            <g transform="translate(12,12) scale(0.9)">
              <circle cx="20" cy="20" r="16" fill="#ffd54a" />
              <path d="M20 10 L25 20 L20 30 L15 20 Z" fill="#e21b2d" />
            </g>
            <path d="M320 24 q12 10 0 24 q-12 14 -24 0 q-12 -14 0 -24 q12 -10 24 0" fill="#fff" opacity="0.95" />
            <path d="M320 26 q10 8 0 20 q-10 12 -20 0 q-10 -12 0 -20 q10 -8 20 0" fill="#e21b2d" />
          </g>
          <g mask="url(#center-hole)">
            <rect x="0" y="660" width="100%" height="120" fill="#e21b2d" />
            <text x="50%" y="704" text-anchor="middle" alignment-baseline="middle" font-size="16" font-weight="600" fill="#fff">17 Agustus 1945, 80 Tahun</text>
          </g>
          <g mask="url(#center-hole)">
            <circle cx="40" cy="360" r="8" fill="#ffd54a" />
            <circle cx="320" cy="360" r="8" fill="#ffd54a" />
          </g>
        </svg>
      </div>
      <div class="topbar">
        <div class="chip" id="flipLabel">kamera belum aktif</div>
      </div>
      <div class="ui">
        <button id="switchBtn" class="secondary">üîÅ ganti kamera</button>
        <button id="captureBtn">üì∏ ambil foto</button>
        <button id="shareBtn" class="secondary">üì§ bagikan</button>
      </div>
      <div class="message" id="msgBox" style="display:none"></div>
    </div>
  </div>
  <script>
    const video = document.getElementById('camera');
    const switchBtn = document.getElementById('switchBtn');
    const captureBtn = document.getElementById('captureBtn');
    const shareBtn = document.getElementById('shareBtn');
    const flipLabel = document.getElementById('flipLabel');
    let stream = null;
    let usingFront = true;

    async function startCamera() {
      if (stream) { stream.getTracks().forEach(t => t.stop()); }
      try {
        const constraints = {
          video: {
            facingMode: usingFront ? 'user' : 'environment',
            width: { ideal: 720 },
            height: { ideal: 1280 },
            aspectRatio: { ideal: 0.75 }
          }
        };
        stream = await navigator.mediaDevices.getUserMedia(constraints);
        video.srcObject = stream;
        video.style.transform = usingFront ? 'translate(-50%,-50%) scaleX(-1)' : 'translate(-50%,-50%) scaleX(1)';
        flipLabel.textContent = usingFront ? 'kamera depan' : 'kamera belakang';
      } catch (err) {
        console.error('Camera error', err);
      }
    }

    switchBtn.addEventListener('click', () => {
      usingFront = !usingFront;
      startCamera();
    });

    captureBtn.addEventListener('click', () => {
      const canvas = document.createElement('canvas');
      canvas.width = 720;
      canvas.height = 960;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      const link = document.createElement('a');
      link.download = 'indonesia80.png';
      link.href = canvas.toDataURL('image/png');
      link.click();
    });

    shareBtn.addEventListener('click', () => {
      captureBtn.click();
    });

    startCamera();
  </script>
</body>
</html>
